/*
	EchoDent UI — Fundação de Design Tokens e Estilos Globais
	Objetivo: Base clean, moderna e profissional (SaaS) com suporte a tema claro/escuro.
	Observação: offline-first; sem imports externos de fontes.
*/

/* ===============================
	 Parte 1 — Design Tokens (Light)
	 =============================== */
:root {
	/* Paleta Primária — Verde Menta */
	--color-primary-light: #34d399; /* mint/green 400 */
	--color-primary-main:  #10b981; /* mint/green 500 */
	--color-primary-dark:  #059669; /* mint/green 600 */

	/* Superfícies (Light) */
	--color-background:    #fafafa; /* fundo da página */
	--color-surface-card:  #ffffff; /* cartões/superfícies elevadas */

	/* Texto */
	--color-text-primary:   #0f172a; /* slate-900 */
	--color-text-secondary: #475569; /* slate-600 */
	--color-text-on-primary:#ffffff; /* texto sobre botão primário */

	/* Bordas */
	--color-border:        #e5e7eb; /* gray-200 */
	--color-border-focus:  #99f6e4; /* teal-200 (realce de foco) */

	/* Tipografia (Offline-First) */
	--font-family-system: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans", "Liberation Sans", sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji;

	/* Geometria e Movimento */
	--border-radius-medium: 10px;
	--shadow-medium: 0 6px 20px rgba(2, 6, 23, 0.08); /* sombra suave profissional */
	--transition-short: 180ms ease;

		/* Espaçamento (escala) */
		--space-1: 0.25rem; /* 4px */
		--space-2: 0.5rem;  /* 8px */
		--space-3: 0.75rem; /* 12px */
		--space-4: 1rem;    /* 16px */
		--space-5: 1.25rem; /* 20px */
		--space-6: 1.5rem;  /* 24px */

		/* Cores de Feedback */
		--color-warning-bg:     #fff7ed; /* amber-50 */
		--color-warning-border: #fed7aa; /* orange-200 */
		--color-warning-text:   #7c2d12; /* amber-900 */

		/* Cores de Erro (Danger) */
		--color-danger-bg:     #fef2f2; /* red-50 */
		--color-danger-border: #fecaca; /* red-200 */
		--color-danger-text:   #7f1d1d; /* red-900 */

		/* Cores de Informação (Info) */
		--color-info-bg:     #eff6ff; /* blue-50 */
		--color-info-border: #bfdbfe; /* blue-200 */
		--color-info-text:   #1e3a8a; /* blue-900 */

		/* Z-Index Tokens (consistentes e documentados) */
		--z-base: 0;
		--z-sticky: 10;           /* headers fixos, etc */
		--z-dropdown: 1000;       /* dropdowns, overlays leves, modal-overlay atual */
		--z-flyover: 3000;        /* menus flutuantes (ex.: context/settings) */
		--z-popover: 4000;        /* popovers de edição (ex.: criar evento) */
		--z-overlay: 10000;       /* sobreposições críticas (ex.: detalhes do evento) */
		--z-ultimate: 99999;      /* lib/vendor (ex.: flatpickr) */
}

/* ================================
	 Parte 2 — Design Tokens (Dark)
	 ================================ */
[data-theme-mode="dark"] {
	/* Superfícies (Dark) */
	--color-background:   #0b1220; /* navy/black suave */
	--color-surface-card: #0f172a; /* slate-900 */

	/* Texto (Dark) */
	--color-text-primary:   #e5e7eb; /* gray-200 */
	--color-text-secondary: #94a3b8; /* slate-400 */

	/* Bordas (Dark) */
	--color-border:       #1f2937; /* gray-800 */
	--color-border-focus: #0ea5e9; /* azul sutil para foco no dark */

		/* Feedback (Dark) */
		--color-warning-bg:     #2b1c0f; /* escuro quente */
		--color-warning-border: #b45309; /* amber-700 */
		--color-warning-text:   #fed7aa; /* orange-200 */

		/* Erro (Danger - Dark) */
		--color-danger-bg:     #2a1212; /* escuro avermelhado */
		--color-danger-border: #ef4444; /* red-500 */
		--color-danger-text:   #fecaca; /* red-200 */

		/* Informação (Info - Dark) */
		--color-info-bg:     #0b2540; /* azul profundo */
		--color-info-border: #3b82f6; /* blue-500 */
		--color-info-text:   #bfdbfe; /* blue-200 */
}

/* =====================================
	 Parte 3 — Reset e Estilos de Fundação
	 ===================================== */
*, *::before, *::after {
	box-sizing: border-box;
}

html, body {
	margin: 0;
	padding: 0;
}

body {
	font-family: var(--font-family-system);
	background-color: var(--color-background);
	color: var(--color-text-primary);
	line-height: 1.5;
	-webkit-font-smoothing: antialiased;
	-moz-osx-font-smoothing: grayscale;
	transition: background-color var(--transition-short),
							color var(--transition-short);
}

/* Tipografia básica */
h1, h2, h3, h4, h5, h6 {
	margin: 0 0 0.5rem;
	color: var(--color-text-primary);
	line-height: 1.2;
}

p {
	margin: 0 0 1rem;
	color: var(--color-text-secondary);
}

a {
	color: var(--color-primary-dark);
	text-decoration: none;
	transition: color var(--transition-short);
}

a:hover {
	color: var(--color-primary-main);
}

/* Superfície padrão de cartões/contêineres */
.card, .surface {
	background-color: var(--color-surface-card);
	color: var(--color-text-primary);
	border: 1px solid var(--color-border);
	border-radius: var(--border-radius-medium);
	box-shadow: var(--shadow-medium);
}

/* Estrutura de cartões */
.card-header {
	padding: var(--space-3) var(--space-4);
	border-bottom: 1px solid var(--color-border);
	font-weight: 600;
}

.card-body {
	padding: var(--space-4);
}

/* Formulários */
input, textarea, select {
	font-family: inherit;
	color: var(--color-text-primary);
	background-color: var(--color-surface-card);
	border: 1px solid var(--color-border);
	border-radius: var(--border-radius-medium);
	padding: 0.563rem 0.75rem; /* 9px 12px aprox. */
	transition: border-color var(--transition-short),
							box-shadow var(--transition-short),
							background-color var(--transition-short),
							color var(--transition-short);
}

input::placeholder, textarea::placeholder {
	color: var(--color-text-secondary);
}

input:focus, textarea:focus, select:focus {
	outline: none;
	border-color: var(--color-border-focus);
	box-shadow: 0 0 0 3px color-mix(in oklab, var(--color-border-focus) 35%, transparent);
}

/* Botão Primário */
.btn {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	gap: 0.5rem;
	height: 40px;
	padding: 0 16px;
	font-weight: 600;
	border: 1px solid transparent;
	border-radius: var(--border-radius-medium);
	cursor: pointer;
	transition: background-color var(--transition-short),
							color var(--transition-short),
							transform var(--transition-short),
							box-shadow var(--transition-short),
							border-color var(--transition-short);
}

.btn-primary {
	color: var(--color-text-on-primary);
	background-color: var(--color-primary-main);
	box-shadow: var(--shadow-medium);
}

.btn-primary:hover {
	background-color: var(--color-primary-dark);
}

.btn-primary:active {
	transform: translateY(1px);
}

.btn-primary:focus-visible {
	outline: none;
	box-shadow: 0 0 0 3px color-mix(in oklab, var(--color-border-focus) 45%, transparent), var(--shadow-medium);
}

/* Botão Secundário (outline/ghost) */
.btn-secondary {
	color: var(--color-text-secondary);
	background-color: transparent;
	border-color: var(--color-border);
}

.btn-secondary:hover {
	color: var(--color-text-primary);
	border-color: var(--color-primary-main);
}

.btn-secondary:focus-visible {
	outline: none;
	box-shadow: 0 0 0 3px color-mix(in oklab, var(--color-border-focus) 35%, transparent), var(--shadow-medium);
}

/* Layout container e header principal */
.layout-container {
	width: 100%;
	max-width: 1100px;
	margin: 0 auto;
	padding: var(--space-4);
}

/* Agenda needs more horizontal room: allow full-width container on that page */
.page-agenda .layout-container { max-width: none; }

.main-header {
	position: sticky;
	top: 0;
	z-index: var(--z-sticky);
	background-color: var(--color-surface-card);
	border-bottom: 1px solid var(--color-border);
	box-shadow: var(--shadow-medium);
}

.main-header .inner {
	display: flex;
	align-items: center;
	justify-content: space-between;
	height: 56px;
}

.brand {
	font-weight: 700;
}

/* Tabelas básicas */
table {
	width: 100%;
	border-collapse: collapse;
	background-color: var(--color-surface-card);
	border: 1px solid var(--color-border);
	border-radius: var(--border-radius-medium);
	overflow: hidden;
}

th, td {
	padding: var(--space-3);
	text-align: left;
	border-top: 1px solid var(--color-border);
}

thead th {
	background-color: color-mix(in oklab, var(--color-border) 40%, var(--color-surface-card));
	border-top: none;
}

/* Alertas baseados em tokens */
.alert {
	padding: var(--space-3) var(--space-4);
	border-radius: var(--border-radius-medium);
	border: 1px solid var(--color-border);
}

.alert-warning {
	background-color: var(--color-warning-bg);
	border-color: var(--color-warning-border);
	color: var(--color-warning-text);
	font-weight: 600;
}

/* Alerta de erro (danger) */
.alert-danger {
	background-color: var(--color-danger-bg);
	border-color: var(--color-danger-border);
	color: var(--color-danger-text);
	font-weight: 700;
}

/* Alerta de sucesso (success) */
.alert-success {
	background-color: var(--color-primary-light);
	border-color: var(--color-primary-main);
	color: var(--color-primary-main);
	font-weight: 700;
}

/* Alerta informativo (info) */
.alert-info {
	background-color: var(--color-info-bg);
	border-color: var(--color-info-border);
	color: var(--color-info-text);
	font-weight: 600;
}

/* Modal de Erro (Overlay + Card) */
.modal-overlay {
	position: fixed;
	inset: 0;
	z-index: var(--z-dropdown);
	background: color-mix(in oklab, #000 55%, transparent);
	display: none; /* ativar com .is-visible */
	align-items: center;
	justify-content: center;
}

.modal-overlay.is-visible { display: flex; }

.modal-card {
	background: var(--color-surface-card);
	color: var(--color-text-primary);
	border: 1px solid var(--color-border);
	border-radius: var(--border-radius-medium);
	box-shadow: var(--shadow-medium);
	max-width: 560px;
	width: min(92vw, 560px);
	padding: var(--space-4);
}

.modal-card .modal-title {
	margin: 0 0 var(--space-3);
	font-weight: 700;
}

.modal-card .modal-actions {
	margin-top: var(--space-4);
	display: flex;
	justify-content: flex-end;
	gap: var(--space-2);
}

/* Modal body scroll area for long error logs */
#error-modal-text, .modal-body-scroll {
	max-height: 300px;
	overflow-y: auto;
	white-space: pre-wrap; /* wrap long lines */
}

/* Utilitários */
.text-right { text-align: right; }
.mt-2 { margin-top: var(--space-2); }
.mb-2 { margin-bottom: var(--space-2); }
.ml-2 { margin-left: var(--space-2); }
.ml-4 { margin-left: var(--space-4); }
.flex { display: flex; }
.flex-wrap { flex-wrap: wrap; }
.gap-2 { gap: var(--space-2); }
.flex-1 { flex: 1 1 auto; }
.max-w-480 { max-width: 480px; }
.w-100 { width: 100%; }

/* Generic visibility helper used across components */
.hidden { display: none !important; }

/* Respeito a acessibilidade: menos movimento quando preferido pelo usuário */
@media (prefers-reduced-motion: reduce) {
	*, *::before, *::after {
		animation-duration: 0.01ms !important;
		animation-iteration-count: 1 !important;
		transition-duration: 0.01ms !important;
		scroll-behavior: auto !important;
	}
}

/* ================================
	 Reusable card layout patterns
	 ================================ */
/* Split card with an aside and main content. Control aside width via --card-sidebar. */
.card-split {
	display: grid;
	grid-template-columns: var(--card-sidebar, 280px) 1fr;
	gap: var(--space-4);
}
.card-split .card-aside {
	min-width: 220px;
	max-width: 360px;
}
.card-split .card-main { min-width: 0; }
@media (max-width: 1024px) {
	.card-split { grid-template-columns: 1fr; }
	.card-split .card-aside { min-width: 0; max-width: none; }
}

/* Utilitários mínimos úteis */
.pre-wrap { white-space: pre-wrap; }
.mt-3 { margin-top: 1rem; }
.mb-3 { margin-bottom: 1rem; }
.mx-auto { margin-left: auto; margin-right: auto; }

/* Impressão: neutralizar visual de preview para PDF */
@media print {
	.print-preview-wrapper.card {
		border: none !important;
		box-shadow: none !important;
		padding: 0 !important;
		background: transparent !important;
	}
	.print-preview-wrapper .card-body {
		padding: 0 !important;
	}
}

/* ================================
	Parte 4 — Sidebar (Desktop Only)
	=============================== */
:root {
	--sidebar-collapsed-width: 68px;
	--sidebar-expanded-width: 240px;
}

/* Estrutura base do layout com sidebar: apenas no desktop */
@media (min-width: 1024px) {
	body {
		display: flex;
	}
	.main-content-wrapper {
		flex: 1;
		min-height: 100vh;
		display: flex;
		flex-direction: column;
	}

	.sidebar {
		width: var(--sidebar-collapsed-width);
		background-color: var(--color-surface-card);
		border-right: 1px solid var(--color-border);
		box-shadow: var(--shadow-medium);
		display: flex;
		flex-direction: column;
		align-items: stretch;
		position: sticky;
		top: 0;
		align-self: flex-start;
		height: 100vh;
		padding: var(--space-4) var(--space-2);
		transition: width var(--transition-short),
						padding var(--transition-short);
	}

	body.sidebar-expanded .sidebar {
		width: var(--sidebar-expanded-width);
		padding-right: var(--space-4);
	}

	.sidebar-header {
		display: flex;
		align-items: center;
		justify-content: space-between; /* logo à esquerda, ações à direita */
		height: 48px;
		padding: 0 var(--space-2);
		margin-bottom: var(--space-4);
	}

	.sidebar-header .header-actions {
		display: flex;
		align-items: center;
		gap: var(--space-2);
	}
	/* Garantir que o botão de tema no header apareça no expandido */
	body.sidebar-expanded .sidebar .header-actions .header-theme-toggle {
		display: inline-flex;
	}

	/* No estado recolhido, esconda a marca para dar espaço ao toggle */
	body:not(.sidebar-expanded) .sidebar .brand {
		display: none;
	}
	body:not(.sidebar-expanded) .sidebar .header-actions .header-theme-toggle {
		display: none;
	}

	.sidebar-nav {
		display: flex;
		flex-direction: column;
		gap: var(--space-1);
	}

	.sidebar-link {
		display: flex;
		align-items: center;
		gap: var(--space-3);
		padding: 10px 12px;
		border-radius: var(--border-radius-medium);
		color: var(--color-text-secondary);
		transition: background-color var(--transition-short), color var(--transition-short);
	}

	.sidebar-link:hover {
		background-color: color-mix(in oklab, var(--color-border) 40%, var(--color-surface-card));
		color: var(--color-text-primary);
	}

	.sidebar .icon { flex: 0 0 auto; }
	.sidebar .link-text {
		opacity: 0;
		white-space: nowrap;
		max-width: 0;
		overflow: hidden;
		transition: opacity var(--transition-short), max-width var(--transition-short);
	}
	body.sidebar-expanded .sidebar .link-text {
		opacity: 1;
		max-width: 320px;
	}

	.sidebar-footer {
		display: flex;
		align-items: center;
		gap: var(--space-2);
		margin-top: auto; /* fixa o footer na base da coluna */
		padding: 0; /* sem padding extra para alinhar com nav */
	}

	/* Área principal entre header e footer para comportar nav e widgets dinâmicos */
	.sidebar .sidebar-main {
		flex: 1 1 auto;
		min-height: 0; /* permite overflow interno */
		overflow: hidden;
		display: flex;
		flex-direction: column;
	}
	.sidebar .sidebar-main .sidebar-nav { flex: 1 1 auto; overflow: auto; }

	/* Slots de widgets da Agenda na sidebar (visíveis apenas no expandido) */
	.sidebar .sidebar-widget-slot {
		display: none;
		margin: var(--space-3) var(--space-2);
		padding: var(--space-2);
		border: 1px solid var(--color-border);
		border-radius: var(--border-radius-medium);
		background: var(--color-surface-card);
		box-shadow: var(--shadow-medium);
	}
	body.sidebar-expanded .sidebar .sidebar-widget-slot { display: block; }

	/* Sticky positioning for better widget placement */
	.sidebar #agendaSidebarTop { position: sticky; top: var(--space-2); z-index: 2; }
	.sidebar #agendaSidebarBottom { position: sticky; bottom: var(--space-2); z-index: 2; }

	/* Mini calendar tweaks inside the sidebar */
	.sidebar #miniCalendar { width: 100%; }
	.sidebar #miniCalendar .fc .fc-toolbar { margin-bottom: var(--space-2); }
	.sidebar #miniCalendar .fc .fc-toolbar-title { font-size: 0.9rem; font-weight: 600; }
	.sidebar #miniCalendar .fc .fc-button { height: 28px; padding: 0 8px; font-size: 0.8rem; }
/* Removed calendar widgets from global sidebar; revert extra sizing rules */

	/* Estado expandido: perfil + logout em uma única linha */
	body.sidebar-expanded .sidebar .sidebar-footer { flex-direction: row; }
	/* Estado recolhido: apenas o perfil (logout escondido) */
	body:not(.sidebar-expanded) .sidebar .sidebar-footer { flex-direction: column; }

	/* Perfil ocupa o espaço restante para que perfil+logout caibam na largura do link padrão */
	.sidebar-footer .sidebar-link { flex: 1 1 auto; width: auto; }

	/* Botão de logout ícone (tamanho uniforme) */
	.sidebar-footer .sidebar-logout-btn { width: 40px; height: 40px; padding: 0; display: inline-flex; align-items: center; justify-content: center; }

	/* No estado recolhido, esconder completamente itens extras do footer */
	body:not(.sidebar-expanded) .sidebar .sidebar-footer .collapse-hidden {
		display: none !important;
	}

	.sidebar-icon-btn {
		width: 40px;
		height: 40px;
		padding: 0;
		justify-content: center;
		gap: 0;
	}

	/* Links de ícone no footer (âncoras) — não fixar largura para permitir texto ao expandir */
	.sidebar-icon-link {
		display: inline-flex;
		align-items: center;
		justify-content: center;
	}

	/* Ícone do chevron com animação de rotação */
	.sidebar-chev { transition: transform var(--transition-short); }
	body.sidebar-expanded .sidebar-chev { transform: rotate(180deg); }

	/* Alternância de ícones de tema (moon/sun) conforme data-theme-mode */
	.theme-icon-sun { display: none; }
	[data-theme-mode="dark"] .theme-icon-sun { display: inline-block; }
	[data-theme-mode="dark"] .theme-icon-moon { display: none; }

	/* Menu do usuário (dropdown) */
	/* (Removido o dropdown; estilos mantidos intencionalmente vazios para compatibilidade futura) */
}

/* Fallback para mobile/tablet: esconder a sidebar, manter layout padrão */
@media (max-width: 1023.98px) {
	.sidebar { display: none; }
}

/* Active link indication */
.sidebar-nav a.active {
	background-color: var(--color-primary-light);
	color: var(--color-primary-dark);
	border: 1px solid color-mix(in oklab, var(--color-primary-main) 50%, var(--color-border));
}

/* =====================================
	Regra 8 — Prevenção de Clique Duplo (HTMX)
	Desabilita interações e dá feedback visual enquanto a requisição está em andamento.
===================================== */
.htmx-request,
.htmx-request * {
	pointer-events: none !important;
	opacity: 0.7;
	cursor: wait !important;
}
