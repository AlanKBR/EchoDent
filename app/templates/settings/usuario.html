<!-- htmlhint doctype-first:false -->
{% extends "base.html" %}
{% block title %}Preferências do Usuário{% endblock %}

{% block styles %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/settings.css') }}?v={{ asset_v }}" />
{% endblock %}

{% block content %}
<div class="settings-container">
  {% set active_tab = 'usuario' %}
  {% include "settings/_tabs.html" %}

  <div class="settings-content">
    <div class="settings-header">
      <h1>Minhas Preferências</h1>
      <p class="text-muted">Configure suas preferências pessoais no sistema.</p>
    </div>

    <div class="card">
      <div class="card-header"><strong>Informações do Perfil</strong></div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-12 col-md-6">
            <label class="form-label">Usuário</label>
            <input type="text" class="form-control" value="{{ user.username }}" disabled>
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label">Nome Completo</label>
            <input type="text" class="form-control" value="{{ user.nome_completo or 'Não definido' }}" disabled>
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label">Papel</label>
            <input type="text" class="form-control" value="{{ user.role.value }}" disabled>
          </div>
          {% if user.role.value == 'DENTISTA' %}
          <div class="col-12 col-md-6">
            <label class="form-label">CRO</label>
            <input type="text" class="form-control" value="{{ user.cro_registro or 'Não definido' }}" disabled>
          </div>
          {% endif %}
        </div>
      </div>
    </div>

    {% if user.role.value == 'DENTISTA' %}
    <form method="POST" action="{{ url_for('settings_bp.usuario_update_color') }}" class="mt-4">
      <div class="card">
        <div class="card-header"><strong>Cor na Agenda</strong></div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12 col-md-6">
              <label for="color" class="form-label">Minha Cor</label>
              <div class="input-group">
                <input type="color" class="form-control form-control-color" id="color" name="color" value="{{ user.color or '#0d6efd' }}" title="Escolha sua cor">
                <input type="text" class="form-control" value="{{ user.color or '#0d6efd' }}" readonly>
              </div>
              <div class="form-text">Esta cor será usada para identificar seus agendamentos na agenda visual.</div>
            </div>
          </div>
          <div class="mt-3">
            <button type="submit" class="btn btn-primary">Salvar Cor</button>
          </div>
        </div>
      </div>
    </form>
    {% endif %}

    <form method="POST" action="{{ url_for('settings_bp.usuario_update') }}" class="mt-4">
      <div class="card">
        <div class="card-header"><strong>Notificações</strong></div>
        <div class="card-body">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" role="switch" id="notificacoes_enabled" name="notificacoes_enabled" {% if prefs.notificacoes_enabled %}checked{% endif %}>
            <label class="form-check-label" for="notificacoes_enabled">
              Ativar notificações
            </label>
          </div>
          <div class="form-text mt-2">
            Receba alertas sobre agendamentos, vencimentos e outras atividades importantes (funcionalidade em desenvolvimento).
          </div>
          <div class="mt-3">
            <button type="submit" class="btn btn-primary">Salvar Preferências</button>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>

{% block scripts %}
  {{ super() }}
  <script src="{{ url_for('static', filename='js/color_sync.js') }}?v={{ asset_v }}" defer></script>
{% endblock %}
{% endblock %}
