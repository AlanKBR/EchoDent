<div class="card mb-3" id="plano-{{ plano.id }}">
  <div class="card-header d-flex justify-content-between align-items-center">
    <div>
      <strong>Plano #{{ plano.id }}</strong>
      <span class="badge bg-secondary ms-2">{{ plano.status.name }}</span>
    </div>
    <div>
      <small>Criado em: {{ plano.created_at | format_datetime_br }}</small>
    </div>
  </div>
  <div class="card-body">
    <div class="mb-2">
      <strong>Itens</strong>
      <ul class="mb-3">
        {% for item in plano.itens %}
          <li>
            {{ item.procedimento_nome_historico }} —
            {{ item.valor_cobrado | format_currency }}
            {% if item.descricao_dente_face %}
              <small class="text-muted">({{ item.descricao_dente_face }})</small>
            {% endif %}
          </li>
        {% else %}
          <li class="text-muted">Nenhum item.</li>
        {% endfor %}
      </ul>
    </div>

    <div class="d-flex align-items-center gap-3">
      <div>
        <strong>Total:</strong> {{ plano.valor_total | format_currency }}
      </div>
      {% if plano.status.name == 'APROVADO' %}
        <div>
          <strong>Status Pagamento:</strong>
          {{ plano.status_pagamento or '—' }}
        </div>
        <div>
          <strong>Saldo:</strong>
          {{ plano.saldo_devedor_calculado | format_currency }}
        </div>
      {% endif %}
    </div>

    {% if plano.status.name == 'PROPOSTO' %}
      <div class="mt-3">
        <div class="mb-2">
          <a class="btn btn-sm btn-outline-secondary"
             hx-get="{{ url_for('financeiro_bp.editar_plano_form', plano_id=plano.id) }}"
             hx-target="#plano-{{ plano.id }}"
             hx-swap="outerHTML">Editar</a>
        </div>
        <form hx-post="{{ url_for('financeiro_bp.aprovar_plano', plano_id=plano.id) }}"
              hx-target="#plano-{{ plano.id }}"
              hx-swap="outerHTML">
          <div class="input-group" style="max-width: 320px;">
            <span class="input-group-text">Desconto</span>
            <input type="number" step="0.01" min="0" name="desconto" class="form-control" placeholder="0,00">
            <button class="btn btn-primary" type="submit">Aprovar</button>
          </div>
        </form>
      </div>
    {% endif %}
  </div>
</div>
